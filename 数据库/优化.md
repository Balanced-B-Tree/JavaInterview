# [业务主表读写缓慢如何优化？ (qq.com)](https://mp.weixin.qq.com/s/vIwfa-C8-V-Wyb8dCOV1tQ)

## 冷热分离

- **热数据**：被频繁更新；响应时间有要求
- **冷数据**：不允许更新（具体业务系统具体分析），偶尔被查询；响应时间无要求。

如果出现了以下场景则应该考虑冷热分离：

1. 主业务响应延迟太大，比如12306下订单太慢了。
2. 数据走到终态后，没有更新需求，只有读的需求，比如订单的完成状态。
3. 用户能够接受新旧数据分开查询，比如携程的订单查询30天之前的需要用手机号查询。



判断冷热数据：

- **时间维度**，可以将3个月之前的数据定义为冷数据，最近3个月的数据定义为热数据。
- **状态维度**，比如订单的状态，已完结的订单定义为冷数据，未完结的订单定义为热数据。



要求：

1. 如果一个数据被标识为冷数据，业务代码不会再对它进行写操作
2. 不会同时存在读冷/热数据的需求。



## 分离方案

### 业务代码修改——依据状态

这种方案是直接修改业务代码，对代码的侵入性比较高，无法按照时间进行区分，在数据修改时触发冷热分离。

![图片](%E4%BC%98%E5%8C%96.assets/640-20220407200406844.png)

### 监听数据库日志——依据状态

该种方案需要监听**binlog**日志的方式进行触发，比如订单状态修改了，则触发冷热分离。

同样的这里**无法按照时间区分**，**但是对代码无侵入**。

![图片](%E4%BC%98%E5%8C%96.assets/640-20220407200441298.png)





### 定时任务扫描——依据状态、时间

该种方案可以按照**时间**区分，与业务代码解耦，是个不错的选择。

![图片](%E4%BC%98%E5%8C%96.assets/640-20220407200457560.png)





